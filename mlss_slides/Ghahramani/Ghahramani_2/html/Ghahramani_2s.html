<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a>Machine&#160;Learning&#160;Summer&#160;School<br/>
Lecture&#160;2:&#160;Inference&#160;and&#160;Propagation&#160;Algorithms<br/>
Zoubin&#160;Ghahramani<br/>
zoubin@eng.cam.ac.uk<br/>
http://learning.eng.cam.ac.uk/zoubin/<br/>
Department&#160;of&#160;Engineering<br/>
University&#160;of&#160;Cambridge,&#160;UK<br/>
Machine&#160;Learning&#160;Department<br/>
Carnegie&#160;Mellon&#160;University,&#160;USA<br/>
August&#160;2009<br/>
<hr/>
<a name=2></a>Inference&#160;in&#160;a&#160;graphical&#160;model<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
Consider&#160;the&#160;following&#160;graph:&#160;<i>E</i><br/>
which&#160;represents:<br/>
p(A,&#160;B,&#160;C,&#160;D,&#160;E)&#160;=&#160;p(A)p(B)p(C|A,&#160;B)p(D|B,&#160;C)p(E|C,&#160;D)<br/>
Inference:&#160;evaluate&#160;the&#160;probability&#160;distribution&#160;over&#160;some&#160;set&#160;of&#160;variables,&#160;given&#160;the&#160;values<br/>of&#160;another&#160;set&#160;of&#160;variables.<br/>
For&#160;example,&#160;how&#160;can&#160;we&#160;compute&#160;p(A|C&#160;=&#160;c)?&#160;Assume&#160;each&#160;variable&#160;is&#160;binary.<br/>
Naive&#160;method:<br/>
X<br/>
p(A,&#160;C&#160;=&#160;c)<br/>
=<br/>
p(A,&#160;B,&#160;C&#160;=&#160;c,&#160;D,&#160;E)<br/>
[16&#160;terms]<br/>
B,D,E<br/>
X<br/>
p(C&#160;=&#160;c)<br/>
=<br/>
p(A,&#160;C&#160;=&#160;c)<br/>
[2&#160;terms]<br/>
A<br/>
p(A,&#160;C&#160;=&#160;c)<br/>
p(A|C&#160;=&#160;c)<br/>
=<br/>
[2&#160;terms]<br/>
p(C&#160;=&#160;c)<br/>
Total:&#160;16+2+2&#160;=&#160;20&#160;terms&#160;have&#160;to&#160;be&#160;computed&#160;and&#160;summed<br/>
<hr/>
<a name=3></a>Inference&#160;in&#160;a&#160;graphical&#160;model<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
Consider&#160;the&#160;following&#160;graph:&#160;<i>E</i><br/>
which&#160;represents:<br/>
p(A,&#160;B,&#160;C,&#160;D,&#160;E)&#160;=&#160;p(A)p(B)p(C|A,&#160;B)p(D|B,&#160;C)p(E|C,&#160;D)<br/>
Computing&#160;p(A|C&#160;=&#160;c).<br/>
More&#160;efficient&#160;method:<br/>
X<br/>
p(A,&#160;C&#160;=&#160;c)<br/>
=<br/>
p(A)p(B)p(C&#160;=&#160;c|A,&#160;B)p(D|B,&#160;C&#160;=&#160;c)p(E|C&#160;=&#160;c,&#160;D)<br/>
B,D,E<br/>
X<br/>
X<br/>
X<br/>
=<br/>
p(A)p(B)p(C&#160;=&#160;c|A,&#160;B)<br/>
p(D|B,&#160;C&#160;=&#160;c)<br/>
p(E|C&#160;=&#160;c,&#160;D)<br/>
B<br/>
D<br/>
E<br/>
X<br/>
=<br/>
p(A)p(B)p(C&#160;=&#160;c|A,&#160;B)<br/>
[4&#160;terms]<br/>
B<br/>
Total:&#160;4+2+2&#160;=&#160;8&#160;terms<br/>
Belief&#160;propagation&#160;methods&#160;use&#160;the&#160;conditional&#160;independence&#160;relationships&#160;in&#160;a&#160;graph&#160;to<br/>do&#160;efficient&#160;inference&#160;(for&#160;singly&#160;connected&#160;graphs,&#160;exponential&#160;gains&#160;in&#160;efficiency!).<br/>
<hr/>
<a name=4></a>Belief&#160;Propagation&#160;(in&#160;singly&#160;connected&#160;DAGs)<br/>
Definition:&#160;A&#160;DAG&#160;is&#160;singly&#160;connected&#160;if&#160;its&#160;underlying&#160;undirected&#160;graph&#160;is&#160;a&#160;tree,&#160;ie&#160;there<br/>is&#160;only&#160;one&#160;undirected&#160;path&#160;between&#160;any&#160;two&#160;nodes.<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>A</i><br/>
<i>B</i><br/>
<i>F</i><br/>
<i>F</i><br/>
<i>C</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>D</i><br/>
<i>E</i><br/>
<i>E</i><br/>
Goal:&#160;For&#160;some&#160;node&#160;X&#160;we&#160;want&#160;to&#160;compute&#160;conditional&#160;p(X|e)&#160;given&#160;evidence&#160;(i.e.<br/>observed,&#160;visible&#160;variables)&#160;e.<br/>
Since&#160;we&#160;are&#160;considering&#160;singly&#160;connected&#160;graphs:<br/>
•&#160;every&#160;node&#160;X&#160;divides&#160;the&#160;evidence&#160;into&#160;upstream&#160;e+&#160;and&#160;downstream&#160;e−<br/>
X<br/>
X<br/>
•&#160;every&#160;edge&#160;X&#160;→&#160;Y&#160;divides&#160;the&#160;evidence&#160;into&#160;upstream&#160;e+<br/>
and&#160;downstream&#160;e−&#160;.<br/>
XY<br/>
XY<br/>
<hr/>
<a name=5></a>Three&#160;key&#160;ideas&#160;behind&#160;Belief&#160;Propagation<br/>
U<br/>
......<br/>
U<br/>
1<br/>
n<br/>
X<br/>
Y<br/>
......<br/>
Y<br/>
1<br/>
m<br/>
Idea&#160;1:<br/>
The&#160;probability&#160;of&#160;a&#160;variable&#160;X&#160;can&#160;be&#160;found&#160;by&#160;combining&#160;upstream&#160;and<br/>
downstream&#160;evidence:<br/>
p(X,&#160;e)<br/>
p(X,&#160;e+&#160;,&#160;e−&#160;)<br/>
p(X|e)&#160;=<br/>
=<br/>
X<br/>
X<br/>
∝&#160;p(X|e+&#160;)<br/>
×<br/>
p(e−&#160;|X,&#160;e+&#160;)<br/>
p(e)<br/>
p(e+&#160;,&#160;e−&#160;)<br/>
X<br/>
X<br/>
X<br/>
X<br/>
X<br/>
|<br/>
{z<br/>
}<br/>
X&#160;d-separates&#160;e−&#160;from&#160;e+<br/>
X<br/>
X<br/>
=&#160;p(X|e+&#160;)p(e−&#160;|X)&#160;=&#160;π(X)λ(X)<br/>
X<br/>
X<br/>
Idea&#160;2:&#160;The&#160;upstream&#160;and&#160;downstream&#160;evidence&#160;can&#160;be&#160;computed&#160;via&#160;a&#160;local&#160;message<br/>passing&#160;algorithm&#160;between&#160;the&#160;nodes&#160;in&#160;the&#160;graph.<br/>
Idea&#160;3:&#160;“Don’t&#160;send&#160;back&#160;to&#160;a&#160;node&#160;(any&#160;part&#160;of)&#160;the&#160;message&#160;it&#160;sent&#160;to&#160;you!”<br/>
<hr/>
<a name=6></a>Factor&#160;graph&#160;propagation<br/>
Algorithmically&#160;and&#160;implementationally,&#160;it’s&#160;often&#160;easier&#160;to&#160;convert&#160;directed&#160;and&#160;undirected<br/>graphs&#160;into&#160;factor&#160;graphs,&#160;and&#160;run&#160;factor&#160;graph&#160;propagation.<br/>
p(x)<br/>
=<br/>
p(x1)p(x2|x1)p(x3|x2)p(x4|x2)<br/>
≡<br/>
f1(x1,&#160;x2)f2(x2,&#160;x3)f3(x2,&#160;x4)<br/>
Singly&#160;connected<br/>
vs<br/>
Multiply&#160;connected&#160;factor&#160;graphs:<br/>
<i>x3</i><br/>
<i>x3</i><br/>
<i>f2</i><br/>
<i>f</i><br/>
<i>f</i><br/>
<i>2</i><br/>
<i>4</i><br/>
<i>f1</i><br/>
<i>x</i><br/>
<i>f</i><br/>
<i>2</i><br/>
<i>1</i><br/>
<i>x2</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>3</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>3</i><br/>
<hr/>
<a name=7></a>Factor&#160;Graphs<br/>
In&#160;a&#160;factor&#160;graph,&#160;the&#160;joint&#160;probability&#160;distribution&#160;is&#160;written&#160;as&#160;a&#160;product&#160;of&#160;factors.<br/>Consider&#160;a&#160;vector&#160;of&#160;variables&#160;x&#160;=&#160;(x1,&#160;.&#160;.&#160;.&#160;,&#160;xn)<br/>
1&#160;Y<br/>
p(x)&#160;=&#160;p(x1,&#160;.&#160;.&#160;.&#160;,&#160;xn)&#160;=<br/>
fj(xS&#160;)<br/>
Z<br/>
j<br/>
j<br/>
where&#160;Z&#160;is&#160;the&#160;normalisation&#160;constant,&#160;Sj&#160;denotes&#160;the&#160;subset&#160;of&#160;{1,&#160;.&#160;.&#160;.&#160;,&#160;n}&#160;which&#160;participate<br/>in&#160;factor&#160;fj&#160;and&#160;xS&#160;=&#160;{x<br/>
j<br/>
i&#160;:&#160;i&#160;∈&#160;Sj&#160;}.<br/>
<i>x3</i><br/>
<i>f</i><br/>
<i>f</i><br/>
<i>2</i><br/>
<i>4</i><br/>
<i>f1</i><br/>
<i>x2</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>3</i><br/>
variables&#160;nodes:&#160;we&#160;draw&#160;open&#160;circles&#160;for&#160;each&#160;variable&#160;xi&#160;in&#160;the&#160;distribution.<br/>factor&#160;nodes:&#160;we&#160;draw&#160;filled&#160;dots&#160;for&#160;each&#160;factor&#160;fj&#160;in&#160;the&#160;distribution.<br/>
<hr/>
<a name=8></a>Propagation&#160;in&#160;Factor&#160;Graphs<br/>
Let&#160;n(x)&#160;denote&#160;the&#160;set&#160;of&#160;factor&#160;nodes&#160;that&#160;are&#160;neighbors&#160;of&#160;x.<br/>Let&#160;n(f&#160;)&#160;denote&#160;the&#160;set&#160;of&#160;variable&#160;nodes&#160;that&#160;are&#160;neighbors&#160;of&#160;f&#160;.<br/>
We&#160;can&#160;compute&#160;probabilities&#160;in&#160;a&#160;factor&#160;graph&#160;by&#160;propagating&#160;messages&#160;from&#160;variable<br/>nodes&#160;to&#160;factor&#160;nodes&#160;and&#160;viceversa.<br/>
message&#160;from&#160;variable&#160;x&#160;to&#160;factor&#160;f&#160;:<br/>
Y<br/>
µx→f&#160;(x)&#160;=<br/>
µh→x(x)<br/>
h∈n(x)\{f&#160;}<br/>
message&#160;from&#160;factor&#160;f&#160;to&#160;variable&#160;x:<br/>
<br/>
<br/>
X<br/>
Y<br/>
µf→x(x)&#160;=<br/>
f&#160;(x)<br/>
µy→f&#160;(y)<br/>
x\x<br/>
y∈n(f&#160;)\{x}<br/>
where&#160;x&#160;are&#160;the&#160;variables&#160;that&#160;factor&#160;f&#160;depends&#160;on,&#160;and&#160;P<br/>
is&#160;a&#160;sum&#160;over&#160;all&#160;variables<br/>
x\x<br/>
neighboring&#160;factor&#160;f&#160;except&#160;x.<br/>
<hr/>
<a name=9></a>Propagation&#160;in&#160;Factor&#160;Graphs<br/>
n(x)&#160;denotes&#160;the&#160;set&#160;of&#160;factor&#160;nodes&#160;that&#160;are&#160;neighbors&#160;of&#160;x.<br/>n(f&#160;)&#160;denotes&#160;the&#160;set&#160;of&#160;variable&#160;nodes&#160;that&#160;are&#160;neighbors&#160;of&#160;f&#160;.<br/>
message&#160;from&#160;variable&#160;x&#160;to&#160;factor&#160;f&#160;:<br/>
Y<br/>
µx→f&#160;(x)&#160;=<br/>
µh→x(x)<br/>
h∈n(x)\{f&#160;}<br/>
message&#160;from&#160;factor&#160;f&#160;to&#160;variable&#160;x:<br/>
<br/>
<br/>
X<br/>
Y<br/>
µf→x(x)&#160;=<br/>
f&#160;(x)<br/>
µy→f&#160;(y)<br/>
x\x<br/>
y∈n(f&#160;)\{x}<br/>
If&#160;a&#160;variable&#160;has&#160;only&#160;one&#160;factor&#160;as&#160;a&#160;neighbor,&#160;it&#160;can&#160;initiate&#160;message&#160;propagation.<br/>
Once&#160;a&#160;variable&#160;has&#160;received&#160;all&#160;messages&#160;from&#160;its&#160;neighboring&#160;factor&#160;nodes,&#160;one&#160;can<br/>compute&#160;the&#160;probability&#160;of&#160;that&#160;variable&#160;by&#160;multiplying&#160;all&#160;the&#160;messages&#160;and&#160;renormalising:<br/>
Y<br/>
p(x)&#160;∝<br/>
µh→x(x)<br/>
h∈n(x)<br/>
<hr/>
<a name=10></a>Propagation&#160;in&#160;Factor&#160;Graphs<br/>
<i>x3</i><br/>
<i>f2</i><br/>
<i>f1</i><br/>
<i>x2</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>3</i><br/>
initialise&#160;all&#160;messages&#160;to&#160;be&#160;constant&#160;functions<br/>
an&#160;example&#160;schedule&#160;of&#160;messages&#160;resulting&#160;in&#160;computing&#160;p(x4):<br/>
message&#160;direction<br/>
message&#160;value<br/>
x1&#160;→&#160;f1<br/>
1(x1)<br/>
x3&#160;→&#160;f2<br/>
1(x3)<br/>
f<br/>
P<br/>
1&#160;→&#160;x2<br/>
f<br/>
x<br/>
1(x1,&#160;x2)1(x1)<br/>
1<br/>
f<br/>
P<br/>
2&#160;→&#160;x2<br/>
f<br/>
x<br/>
2(x3,&#160;x2)1(x3)<br/>
3<br/>
<br/>
&#160;<br/>
<br/>
x<br/>
P<br/>
P<br/>
2&#160;→&#160;f3<br/>
f<br/>
f<br/>
x<br/>
1(x1,&#160;x2)<br/>
2(x3,&#160;x2)<br/>
1<br/>
x3<br/>
<br/>
&#160;<br/>
<br/>
f<br/>
P<br/>
P<br/>
P<br/>
3&#160;→&#160;x4<br/>
f<br/>
f<br/>
f<br/>
x<br/>
3(x2,&#160;x4)<br/>
1(x1,&#160;x2)<br/>
2(x3,&#160;x2)<br/>
2<br/>
x1<br/>
x3<br/>
where&#160;1(x)&#160;is&#160;a&#160;constant&#160;uniform&#160;function&#160;of&#160;x<br/>
<hr/>
<a name=11></a>Propagation&#160;in&#160;Factor&#160;Graphs<br/>
<i>x3</i><br/>
<i>f2</i><br/>
<i>f1</i><br/>
<i>x2</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>3</i><br/>
an&#160;example&#160;schedule&#160;of&#160;messages&#160;resulting&#160;in&#160;computing&#160;p(x4|x1&#160;=&#160;a):<br/>
message&#160;direction<br/>
message&#160;value<br/>
x1&#160;→&#160;f1<br/>
δ(x1&#160;=&#160;a)<br/>
x3&#160;→&#160;f2<br/>
1(x3)<br/>
f<br/>
P<br/>
1&#160;→&#160;x2<br/>
f<br/>
x<br/>
1(x1,&#160;x2)δ(x1&#160;=&#160;a)&#160;=&#160;f1(x1&#160;=&#160;a,&#160;x2)<br/>
1<br/>
f<br/>
P<br/>
2&#160;→&#160;x2<br/>
f<br/>
x<br/>
2(x3,&#160;x2)1(x3)<br/>
3<br/>
<br/>
<br/>
x<br/>
P<br/>
2&#160;→&#160;f3<br/>
f1(x1&#160;=&#160;a,&#160;x2)<br/>
f<br/>
x<br/>
2(x3,&#160;x2)<br/>
3<br/>
<br/>
<br/>
f<br/>
P<br/>
P<br/>
3&#160;→&#160;x4<br/>
f<br/>
f<br/>
x<br/>
3(x2,&#160;x4)f1(x1&#160;=&#160;a,&#160;x2)<br/>
2(x3,&#160;x2)<br/>
2<br/>
x3<br/>
where&#160;δ(x&#160;=&#160;a)&#160;is&#160;a&#160;delta&#160;function<br/>
<hr/>
<a name=12></a>Elimination&#160;Rules&#160;for&#160;Factor&#160;Graphs<br/>
<i>x3</i><br/>
<i>f2</i><br/>
<i>f1</i><br/>
<i>x2</i><br/>
<i>x</i><br/>
<i>x</i><br/>
<i>1</i><br/>
<i>f</i><br/>
<i>4</i><br/>
<i>3</i><br/>
•&#160;eliminating&#160;observed&#160;variables<br/>
If&#160;a&#160;variable&#160;xi&#160;is&#160;observed,&#160;i.e.&#160;its&#160;value&#160;is&#160;given,&#160;then&#160;it&#160;is&#160;a&#160;constant&#160;in&#160;all&#160;factor&#160;that<br/>include&#160;xi.<br/>
We&#160;can&#160;eliminate&#160;xi&#160;from&#160;the&#160;graph&#160;by&#160;removing&#160;the&#160;corresponding&#160;node&#160;and&#160;modifying<br/>all&#160;neighboring&#160;factors&#160;to&#160;treat&#160;it&#160;as&#160;a&#160;constant.<br/>
<hr/>
<a name=13></a>Elimination&#160;Rules&#160;for&#160;Factor&#160;Graphs<br/>
•&#160;eliminating&#160;hidden&#160;variables<br/>
If&#160;a&#160;variable&#160;xi&#160;is&#160;hidden&#160;and&#160;we&#160;are&#160;not&#160;interested&#160;in&#160;it&#160;we&#160;can&#160;eliminate&#160;it&#160;from&#160;the<br/>graph&#160;by&#160;summing&#160;over&#160;all&#160;its&#160;values.<br/>
X<br/>
1&#160;X&#160;Y<br/>
p(x)<br/>
=<br/>
fj(xS&#160;)<br/>
Z<br/>
j<br/>
xi<br/>
xi<br/>
j<br/>
<br/>
<br/>
1<br/>
Y<br/>
X<br/>
Y<br/>
=<br/>
fj(xS&#160;)<br/>
fk(xS&#160;)<br/>
Z<br/>
j<br/>
k<br/>
j&#160;/<br/>
∈n(x<br/>
x<br/>
i)<br/>
i<br/>
k∈n(xi)<br/>
1<br/>
Y<br/>
=<br/>
fj(xS&#160;)<br/>
fnew(xS<br/>
)<br/>
Z<br/>
j<br/>
new<br/>
j&#160;/<br/>
∈n(xi)<br/>
[<br/>
where&#160;f<br/>
Q<br/>
new(xS<br/>
)&#160;=&#160;P<br/>
f<br/>
)&#160;and&#160;S<br/>
S<br/>
new<br/>
x<br/>
k(xS<br/>
new&#160;=<br/>
k&#160;\&#160;{i}.<br/>
i<br/>
k∈n(xi)<br/>
k<br/>
k∈n(xi)<br/>
This&#160;causes&#160;all&#160;its&#160;neighboring&#160;factor&#160;nodes&#160;to&#160;merge&#160;into&#160;one&#160;new&#160;factor&#160;node.<br/>
<hr/>
<a name=14></a>Inference&#160;in&#160;Hidden&#160;markov&#160;models&#160;and<br/>
Linear&#160;Gaussian&#160;state-space&#160;models<br/>
<i>X</i><br/>
<br/>
1<br/>
<i>X</i><br/>
<i>X</i><br/>
<br/>
2<br/>
<i>X&#160;</i>3<br/>
T<br/>
<i>Y</i><br/>
<br/>
1<br/>
<i>Y</i><br/>
<i>Y</i><br/>
<br/>
2<br/>
<i>Y</i>3<br/>
T<br/>
T<br/>
Y<br/>
p(X1,...,T&#160;,&#160;Y1,...,T&#160;)&#160;=&#160;p(X1)p(Y1|X1)<br/>
[p(Xt|Xt−1)p(Yt|Xt)]<br/>
t=2<br/>
•&#160;In&#160;HMMs,&#160;the&#160;states&#160;Xt&#160;are&#160;discrete.<br/>
•&#160;In&#160;linear&#160;Gaussian&#160;SSMs,&#160;the&#160;states&#160;are&#160;real&#160;Gaussian&#160;vectors.<br/>
•&#160;Both&#160;HMMs&#160;and&#160;SSMs&#160;can&#160;be&#160;represented&#160;as&#160;singly&#160;connected&#160;DAGs.<br/>
•&#160;The&#160;forward–backward&#160;algorithm&#160;in&#160;hidden&#160;Markov&#160;models&#160;(HMMs),&#160;and&#160;the&#160;Kalman<br/>
smoothing&#160;algorithm&#160;in&#160;SSMs&#160;are&#160;both&#160;instances&#160;of&#160;belief&#160;propagation&#160;/&#160;factor&#160;graph<br/>propagation.<br/>
<hr/>
<a name=15></a>Inference&#160;in&#160;multiply&#160;connected&#160;DAGs<br/>
The&#160;Junction&#160;Tree&#160;algorithm:&#160;Form&#160;an&#160;undirected&#160;graph&#160;from&#160;your&#160;directed&#160;graph&#160;such<br/>that&#160;no&#160;additional&#160;conditional&#160;independence&#160;relationships&#160;have&#160;been&#160;created&#160;(this&#160;step&#160;is<br/>called&#160;“moralization”).&#160;Lump&#160;variables&#160;in&#160;cliques&#160;together&#160;and&#160;form&#160;a&#160;tree&#160;of&#160;cliques—this<br/>may&#160;require&#160;a&#160;nasty&#160;step&#160;called&#160;“triangulation”.&#160;Do&#160;inference&#160;in&#160;this&#160;tree&#160;of&#160;cliques.<br/>
Cutset&#160;Conditioning:&#160;or&#160;“reasoning&#160;by&#160;assumptions”.&#160;Find&#160;a&#160;small&#160;set&#160;of&#160;variables&#160;which,<br/>if&#160;they&#160;were&#160;given&#160;(i.e.&#160;known)&#160;would&#160;render&#160;the&#160;remaining&#160;graph&#160;singly&#160;connected.&#160;For&#160;each<br/>value&#160;of&#160;these&#160;variables&#160;run&#160;belief&#160;propagation&#160;on&#160;the&#160;singly&#160;connected&#160;network.&#160;Average<br/>the&#160;resulting&#160;beliefs&#160;with&#160;the&#160;appropriate&#160;weights&#160;(given&#160;by&#160;normalizing&#160;constants).<br/>
Loopy&#160;Belief&#160;Propagation:&#160;just&#160;use&#160;BP&#160;although&#160;there&#160;are&#160;loops.&#160;In&#160;this&#160;case&#160;the&#160;terms<br/>“upstream”&#160;and&#160;“downstream”&#160;are&#160;not&#160;clearly&#160;defined.<br/>
No&#160;guarantee&#160;of&#160;convergence,<br/>
except&#160;for&#160;certain&#160;special&#160;graphs,&#160;but&#160;often&#160;works&#160;well&#160;in&#160;practice&#160;(c.f.&#160;“turbo-decoding”<br/>for&#160;error-correcting&#160;codes).<br/>
<hr/>
<a name=16></a>The&#160;Junction&#160;Tree&#160;Algorithm&#160;1<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>F</i><br/>
<i>E</i><br/>
starting&#160;with&#160;a&#160;DAG...<br/>
<hr/>
<a name=17></a>The&#160;Junction&#160;Tree&#160;Algorithm&#160;2<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>F</i><br/>
<i>E</i><br/>
moralize&#160;by&#160;marrying&#160;the&#160;parents&#160;of&#160;each&#160;node<br/>remove&#160;edge&#160;directions<br/>this&#160;results&#160;in&#160;an&#160;undirected&#160;graph&#160;with&#160;no&#160;additional&#160;conditional&#160;independence&#160;relations<br/>
<hr/>
<a name=18></a>The&#160;Junction&#160;Tree&#160;Algorithm&#160;3<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>F</i><br/>
<i>E</i><br/>
triangulate&#160;so&#160;that&#160;there&#160;is&#160;no&#160;loop&#160;of&#160;length&#160;&gt;&#160;3&#160;without&#160;a&#160;chord<br/>this&#160;is&#160;necessary&#160;so&#160;that&#160;the&#160;final&#160;junction&#160;tree&#160;satisfies&#160;the&#160;running&#160;intersection&#160;property<br/>
<hr/>
<a name=19></a>The&#160;Junction&#160;Tree&#160;Algorithm&#160;4<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>F</i><br/>
<i>E</i><br/>
find&#160;cliques&#160;of&#160;the&#160;moralized,&#160;triangulated&#160;graph<br/>
<hr/>
<a name=20></a>The&#160;Junction&#160;Tree&#160;Algorithm&#160;5<br/>
<i>A</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>B&#160;C</i><br/>
<i>B</i><br/>
<i>C</i><br/>
<i>D</i><br/>
<i>CD</i><br/>
<i>C&#160;E</i><br/>
<i>F</i><br/>
<i>CE</i><br/>
<i>C&#160;D</i><br/>
<i>E</i><br/>
•&#160;form&#160;junction&#160;tree:&#160;tree&#160;of&#160;(overlapping)&#160;sets&#160;of&#160;variables<br/>
•&#160;the&#160;running&#160;intersection&#160;property&#160;means&#160;that&#160;if&#160;a&#160;variable&#160;appears&#160;in&#160;more&#160;than&#160;one<br/>
clique&#160;(e.g.&#160;C),&#160;it&#160;appears&#160;in&#160;all&#160;intermediate&#160;cliques&#160;in&#160;the&#160;tree.<br/>
•&#160;the&#160;junction&#160;tree&#160;propagation&#160;algorithm&#160;ensures&#160;that&#160;neighboring&#160;cliques&#160;have&#160;consistent<br/>
probability&#160;distribution<br/>
•&#160;local&#160;consistency&#160;→&#160;global&#160;consistency<br/>
<hr/>
<a name=21></a>Summary<br/>
•&#160;inference&#160;consists&#160;of&#160;the&#160;problem&#160;of&#160;computing&#160;p(variables&#160;of&#160;interest|observed&#160;variables)<br/>
•&#160;for&#160;singly&#160;connected&#160;DAGs,&#160;belief&#160;propagation&#160;solves&#160;this&#160;problem&#160;exactly.<br/>
•&#160;for&#160;factor&#160;graphs,&#160;the&#160;analogous&#160;algorithm&#160;is&#160;factor&#160;graph&#160;propagation.<br/>
•&#160;well-known&#160;algorithms&#160;such&#160;as&#160;Kalman&#160;smoothing&#160;and&#160;forward-backward&#160;are&#160;special<br/>
cases&#160;these&#160;general&#160;propagation&#160;algorithms.<br/>
•&#160;for&#160;multiply&#160;connected&#160;graphs,&#160;the&#160;junction&#160;tree&#160;algorithm&#160;solves&#160;the&#160;exact&#160;inference<br/>
problem,&#160;but&#160;can&#160;be&#160;very&#160;slow&#160;(exponential&#160;in&#160;the&#160;cardinality&#160;of&#160;the&#160;largest&#160;clique).<br/>
•&#160;one&#160;approximate&#160;inference&#160;algorithm&#160;is&#160;“loopy&#160;belief&#160;propagation”—we&#160;will&#160;see&#160;other<br/>
approximate&#160;inference&#160;algorithms&#160;in&#160;a&#160;later&#160;lecture.<br/>
<hr/>
<a name=22></a>Appendix:&#160;Belief&#160;Propagation<br/>
top-down&#160;upstream&#160;evidence:<br/>(message&#160;Ui&#160;sends&#160;to&#160;X)<br/>
π<br/>
)<br/>
U<br/>
......<br/>
U<br/>
X&#160;(Ui)&#160;=&#160;p(Ui|e+<br/>
U<br/>
1<br/>
n<br/>
iX<br/>
X<br/>
bottom-up&#160;downstream&#160;evidence:<br/>(message&#160;Yj&#160;sends&#160;to&#160;X)<br/>
Y<br/>
......<br/>
Y<br/>
1<br/>
m<br/>
λY&#160;(X)&#160;=&#160;p(e−&#160;|X)<br/>
j<br/>
XYj<br/>
To&#160;update&#160;the&#160;probability&#160;of&#160;X&#160;given&#160;the&#160;evidence:<br/>
1<br/>
BEL(X)&#160;=&#160;p(X|e)&#160;=<br/>
λ(X)&#160;π(X)<br/>
Z<br/>
Y<br/>
λ(X)&#160;=<br/>
λY&#160;(X)<br/>
j<br/>
j<br/>
X<br/>
Y<br/>
π(X)&#160;=<br/>
p(X|U1,&#160;.&#160;.&#160;.&#160;,&#160;Un)<br/>
πX(Ui)<br/>
U1···Un<br/>
i<br/>
<hr/>
<a name=23></a>Belief&#160;Propagation&#160;(cont.)<br/>
top-down&#160;upstream&#160;evidence:<br/>(message&#160;Ui&#160;sends&#160;to&#160;X)<br/>
π<br/>
)<br/>
U<br/>
......<br/>
U<br/>
X&#160;(Ui)&#160;=&#160;p(Ui|e+<br/>
U<br/>
1<br/>
n<br/>
iX<br/>
X<br/>
bottom-up&#160;downstream&#160;evidence:<br/>(message&#160;Yj&#160;sends&#160;to&#160;X)<br/>
Y<br/>
......<br/>
Y<br/>
1<br/>
m<br/>
λY&#160;(X)&#160;=&#160;p(e−&#160;|X)<br/>
j<br/>
XYj<br/>
Bottom-up&#160;propagation,&#160;message&#160;X&#160;sends&#160;to&#160;Ui:<br/>
X<br/>
X<br/>
Y<br/>
λX(Ui)&#160;=<br/>
λ(X)<br/>
p(X|U1,&#160;.&#160;.&#160;.&#160;,&#160;Un)<br/>
πX(Uk)<br/>
X<br/>
Uk:k6=i<br/>
k6=i<br/>
Top-down&#160;propagation,&#160;message&#160;X&#160;sends&#160;to&#160;Yj:<br/>
1<br/>
Y<br/>
1&#160;BEL(X)<br/>
π<br/>
&#160;Y<br/>
Y&#160;(X&#160;)&#160;=<br/>
λ&#160;(X)&#160;X&#160;p(X|U<br/>
π<br/>
j<br/>
Y<br/>
1,&#160;.&#160;.&#160;.&#160;,&#160;Un)<br/>
X&#160;(Ui)&#160;=<br/>
Z<br/>
k<br/>
Z&#160;λY&#160;(X)<br/>
k6=j<br/>
U<br/>
j<br/>
1···Un<br/>
i<br/>
Z&#160;is&#160;the&#160;normaliser&#160;ensuring&#160;P<br/>
π&#160;(X)&#160;=&#160;1<br/>
Demo?<br/>
X<br/>
Yj<br/>
<hr/>
<a name=24></a>Appendix:<br/>
Fluffy&#160;and&#160;Moby:&#160;A&#160;Belief&#160;Propagation&#160;Demo<br/>
<hr/>
<a name=25></a>1.&#160;Model&#160;Structure<br/>
<br/>
y = pet cat<br/>
Moby = pet fish<br/>
<br/>
<br/>
y ate Moby<br/>
y has flu<br/>
<i>x</i><br/>
<i>x</i><br/>
1<br/>
2<br/>
<i>x</i><br/>
<i>x</i><br/>
<i>x</i><br/>
3<br/>
4<br/>
5<br/>
<br/>
Moby is&#160;dead<br/>
y is<br/>
<br/>
y has high&#160;<br/>
hungry<br/>
temperature<br/>
<i>x</i>6<br/>
<br/>
y's food&#160;<br/>
bowl is full<br/>
<hr/>
<a name=26></a>2.&#160;Model&#160;Parameters<br/>
<br/>
y = pet cat<br/>
Moby = pet fish<br/>
P(x1=1)=0.01<br/>
P(x2=1)=0.01<br/>
<br/>
<br/>
y ate Moby<br/>
y has flu<br/>
&#160;&#160;P(x4=1|x1,x2)<br/>
<i>x</i><br/>
&#160;&#160;x1,&#160;x2&#160; &#160;&#160;x4=1<br/>
<i>x</i><br/>
1<br/>
2<br/>
&#160;&#160;0&#160; &#160;&#160;0&#160; &#160; &#160;0.9<br/>&#160;&#160;0&#160; &#160;&#160;1&#160; &#160; &#160;0.1<br/>
P(x5=1|x2=0)=0.1<br/>
P(x3=1|x1=0)=0.1<br/>
&#160;&#160;1&#160; &#160;&#160;0&#160; &#160; &#160;0.1<br/>
P(x5=1|x2=1)=0.9<br/>
P(x3=1|x1=1)=1.0<br/>
&#160;&#160;1&#160; &#160;&#160;1&#160; &#160; &#160;0.01<br/>
<i>x</i><br/>
<i>x</i><br/>
<i>x</i><br/>
3<br/>
4<br/>
5<br/>
<br/>
Moby is&#160;dead<br/>
y is<br/>
<br/>
y has high&#160;<br/>
hungry<br/>
temperature<br/>
P(x6=1|x4=0)=0.9<br/>P(x6=1|x4=1)=0.1<br/>
<i>x</i>6<br/>
<br/>
y's food&#160;<br/>
bowl is full<br/>
<hr/>
<a name=27></a>3.&#160;Propagating&#160;Evidence<br/>
P(x1=1)=0.01<br/>
<br/>
<br/>
y ate Moby<br/>
y&#160;has&#160;flu<br/>
<i>x</i><br/>
<i>x</i><br/>
1<br/>
2<br/>
P(x3=1|x1=0)=0.1<br/>P(x3=1|x1=1)=1.0<br/>
<i>x&#160;</i>1<br/>
<i>x&#160;</i>3<br/>
<i>x</i><br/>
<i>x</i><br/>
<i>x</i><br/>
3<br/>
4<br/>
5<br/>
<br/>
Moby is dead<br/>
y is<br/>
<br/>
y&#160;has&#160;high&#160;<br/>
hungry<br/>
temperature<br/>
<i>x</i>6<br/>
<br/>
y's&#160;food&#160;<br/>
1.&#160;Observe&#160;“Moby&#160;is&#160;dead”,&#160;i.e.&#160;x3&#160;=&#160;1<br/>
bowl&#160;is&#160;full<br/>
&#160;0.1&#160;<br/>
2.&#160;Send&#160;λx&#160;(x<br/>
|x<br/>
message&#160;x<br/>
3<br/>
1)&#160;≡&#160;p(e−<br/>
x<br/>
1)&#160;=<br/>
3&#160;→&#160;x1<br/>
1→x3<br/>
1.0<br/>
&#160;0.99&#160;<br/>
&#160;0.1&#160;<br/>
&#160;0.91&#160;<br/>
3.&#160;BEL(x1|x3&#160;=&#160;1)&#160;=&#160;1<br/>
<br/>
=<br/>
Z<br/>
0.01<br/>
1.0<br/>
0.09<br/>
<hr/>
<a name=28></a>4.&#160;Propagating&#160;Evidence<br/>
<br/>
<br/>
y ate Moby<br/>
y&#160;has&#160;flu<br/>
<i>x</i><br/>
<i>x</i><br/>
1<br/>
2<br/>
π &#160;( &#160;<br/>
<i>x</i>4&#160;&#160; &#160;)<i>x</i>1<br/>
<i>x&#160;</i>2<br/>
<i>x&#160;</i>4<br/>
<i>x</i><br/>
<i>x</i><br/>
<i>x</i><br/>
3<br/>
4<br/>
5<br/>
<br/>
Moby is dead<br/>
y is<br/>
<br/>
y&#160;has&#160;high&#160;<br/>
hungry<br/>
temperature<br/>
&#160;0.91&#160;<br/>
<i>x</i>6<br/>
4.&#160;Send&#160;πx&#160;(x<br/>
)&#160;=<br/>
4<br/>
1)&#160;≡&#160;p(x1|e+<br/>
x<br/>
<br/>
1→x4<br/>
0.09<br/>
y's&#160;food&#160;<br/>
bowl&#160;is&#160;full<br/>
&#160;0.99&#160;<br/>
5.&#160;Send&#160;πx&#160;(x<br/>
)&#160;=&#160;p(x<br/>
from&#160;x<br/>
4<br/>
2)&#160;≡&#160;p(x2|e+<br/>
x<br/>
2)&#160;=<br/>
2&#160;→&#160;x4.<br/>
2→x4<br/>
0.01<br/>
&#160;0.18&#160;<br/>
6.&#160;Compute&#160;π(x4)&#160;≡&#160;p(x4|e+&#160;)&#160;=&#160;P<br/>
p(x<br/>
(x<br/>
(x<br/>
x<br/>
4|x1,&#160;x2)πx<br/>
1)πx<br/>
2)&#160;=<br/>
4<br/>
x1,x2<br/>
4<br/>
4<br/>
0.82<br/>
&#160;0.18&#160;<br/>
&#160;0.1&#160;<br/>
7.&#160;BEL(x4|x3&#160;=&#160;1)&#160;=<br/>
,&#160;whereas&#160;before&#160;observing&#160;x<br/>
.<br/>
0.82<br/>
3&#160;=&#160;1,&#160;BEL(x4)&#160;=<br/>
0.9<br/>
<hr/>
<a name=29></a>5.&#160;Propagating&#160;Evidence<br/>
<br/>
<br/>
y ate Moby<br/>
&#160;&#160;P(x4=1|x1,x2)<br/>
y&#160;has&#160;flu<br/>
<i>x</i><br/>
&#160;&#160;x1,&#160;x2&#160; &#160;&#160;x4=1<br/>&#160;&#160;0&#160; &#160;&#160;0&#160; &#160; &#160;0.9<br/>
<i>x</i><br/>
1<br/>
2<br/>
&#160;&#160;0&#160; &#160;&#160;1&#160; &#160; &#160;0.1<br/>&#160;&#160;1&#160; &#160;&#160;0&#160; &#160; &#160;0.1<br/>
λ &#160;( &#160; &#160; )&#160;&#160;&#160;1&#160; &#160;&#160;1&#160; &#160; &#160;0.01<br/>
<i>x</i>4&#160;<i>x</i><br/>
<i>x</i><br/>
1<br/>
<i>x</i><br/>
<i>x</i><br/>
3<br/>
4<br/>
5<br/>
<br/>
Moby is dead<br/>
y is<br/>
<br/>
y&#160;has&#160;high&#160;<br/>
hungry<br/>
temperature<br/>
&#160; &#160; )<i>x&#160;</i>4<br/>
λ &#160;(&#160;&#160;<i>x&#160;</i>6<br/>
P(x6=1|x4=0)=0.9<br/>P(x6=1|x4=1)=0.1<br/>
8.&#160;Observe&#160;“Fluffy’s&#160;Food&#160;Bowl&#160;is&#160;Full”&#160;x6&#160;=&#160;1&#160;!<br/>
&#160;0.9&#160;<br/>
<i>x</i>6<br/>
9.&#160;Send&#160;λx&#160;(x<br/>
message&#160;x<br/>
6<br/>
4)&#160;=<br/>
6&#160;→&#160;x4<br/>
<br/>
0.1<br/>
y's&#160;food&#160;<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
bowl&#160;is&#160;full<br/>
0.18<br/>
0.9<br/>
0.66<br/>
10.&#160;BEL(x4|x3&#160;=&#160;1,&#160;x6&#160;=&#160;1)&#160;=&#160;1<br/>
<br/>
=<br/>
Z<br/>
0.82<br/>
0.1<br/>
0.34<br/>
&#160;0.19&#160;<br/>
11.&#160;Send&#160;λx&#160;(x<br/>
λ&#160;(x<br/>
p(x<br/>
(x<br/>
4<br/>
1)&#160;=&#160;Px<br/>
x<br/>
4)&#160;P<br/>
4|x1,&#160;x2)πx<br/>
2)&#160;=<br/>
4<br/>
6<br/>
x2<br/>
4<br/>
0.82<br/>
&#160;0.99&#160;&#160;&#160;0.1&#160;&#160;&#160;0.19&#160;&#160;&#160;0.70&#160;<br/>
12.&#160;BEL(x1|x3&#160;=&#160;1,&#160;x6&#160;=&#160;1)&#160;=&#160;1<br/>
<br/>
<br/>
=<br/>
⇒&#160;Fluffy&#160;still&#160;innocent!<br/>
Z<br/>
0.01<br/>
1.0<br/>
0.82<br/>
0.30<br/>
<hr/>
<a name=30></a>Appendix:&#160;Understanding&#160;BP&#160;equations<br/>
U<br/>
......<br/>
U<br/>
1<br/>
n<br/>
X<br/>
Y<br/>
......<br/>
Y<br/>
1<br/>
m<br/>
p(X|e)&#160;=&#160;BEL(X)&#160;=<br/>
1&#160;λ(X)π(X)&#160;=&#160;p(e−&#160;|X)p(X|e+&#160;)<br/>
(1)<br/>
Z<br/>
X<br/>
X<br/>
p(e−&#160;|X)&#160;=&#160;λ(X)&#160;=<br/>
Q<br/>
λ&#160;(X)&#160;=&#160;Q&#160;p(e−<br/>
|X)<br/>
(2)<br/>
X<br/>
j<br/>
Yj<br/>
j<br/>
XYj<br/>
p(X|e+&#160;)&#160;=&#160;π(X)&#160;=<br/>
P<br/>
p(X|U<br/>
π<br/>
X<br/>
U<br/>
1,&#160;.&#160;.&#160;.&#160;,&#160;Un)&#160;Q<br/>
X&#160;(Ui)<br/>
(3)<br/>
1···Un<br/>
i<br/>
=<br/>
P<br/>
p(X|U<br/>
p(U<br/>
)<br/>
(4)<br/>
U<br/>
1,&#160;.&#160;.&#160;.&#160;,&#160;Un)&#160;Q<br/>
i|e+<br/>
1···Un<br/>
i<br/>
UiX<br/>
Z&#160;is&#160;a&#160;normalization&#160;constant.<br/>All&#160;equations&#160;follow&#160;from&#160;the&#160;conditional&#160;independencies&#160;in&#160;the&#160;graph.<br/>
<hr/>
</body>
</html>
